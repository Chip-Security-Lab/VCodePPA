Pipelined arbiter with state machine