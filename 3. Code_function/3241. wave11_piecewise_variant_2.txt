Piecewise waveform generation state machine