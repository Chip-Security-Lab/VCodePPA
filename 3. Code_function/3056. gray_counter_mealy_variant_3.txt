Bidirectional Gray counter with handshaking