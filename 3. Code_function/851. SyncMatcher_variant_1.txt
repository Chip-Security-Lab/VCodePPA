Pipelined pattern matcher with handshaking