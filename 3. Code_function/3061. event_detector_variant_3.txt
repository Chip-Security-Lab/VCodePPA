State-based event sequence detector