Masked pattern detector with subtraction