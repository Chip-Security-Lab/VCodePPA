Pattern detector with handshake protocol