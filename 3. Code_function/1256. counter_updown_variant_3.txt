Pipelined bidirectional counter with handshaking