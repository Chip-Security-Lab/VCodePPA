CAN protocol state machine controller