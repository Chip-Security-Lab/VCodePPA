Pipelined DRAM controller with states