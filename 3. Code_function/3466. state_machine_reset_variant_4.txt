Pattern-detecting state machine with pipeline.