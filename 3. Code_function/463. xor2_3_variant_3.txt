Hierarchical XOR with handshaking protocol