Pipelined threshold comparison state machine