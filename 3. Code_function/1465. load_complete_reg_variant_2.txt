Handshake datapath with edge detection