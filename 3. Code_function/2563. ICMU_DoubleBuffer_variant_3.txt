Double buffer for context switching