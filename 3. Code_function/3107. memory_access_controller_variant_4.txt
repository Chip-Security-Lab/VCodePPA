Pipelined memory controller with handshaking