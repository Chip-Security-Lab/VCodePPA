Predictive coding with residual calculation