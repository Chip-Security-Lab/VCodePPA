Priority encoder with state machine