Pipelined vending machine state machine