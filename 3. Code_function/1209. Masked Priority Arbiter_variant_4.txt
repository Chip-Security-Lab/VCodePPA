Masked priority arbiter with handshaking