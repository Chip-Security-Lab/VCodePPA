Threshold detector with state register