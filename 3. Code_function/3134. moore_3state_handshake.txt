Three-state handshake protocol controller