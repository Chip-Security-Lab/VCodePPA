Pipelined memory write state machine