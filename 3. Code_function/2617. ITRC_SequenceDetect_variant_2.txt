Two-stage sequence pattern detector