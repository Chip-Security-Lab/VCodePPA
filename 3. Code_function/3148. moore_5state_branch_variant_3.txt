Branching state machine with paths