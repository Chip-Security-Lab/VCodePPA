Layered I2C communication state machine