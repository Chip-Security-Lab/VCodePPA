Instruction decoder with state machine