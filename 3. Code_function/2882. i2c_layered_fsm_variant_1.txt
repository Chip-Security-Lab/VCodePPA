I2C layered state machine controller